# Pipeline 事件处理管线服务配置
# 文档: docs/architecture/pipeline-design.md

# 输入配置
input:
  kafka:
    brokers:
      - "localhost:19092"
    topic: "edr.events.raw"
    consumer_group: "pipeline-processor"
    concurrency: 10
    min_bytes: 1024          # 1KB
    max_bytes: 10485760      # 10MB
    max_wait: 500ms
    commit_interval: 1s

# 处理配置
processing:
  batch_size: 1000
  batch_timeout: 100ms
  worker_count: 10

# 丰富化配置
enrichment:
  geoip:
    enabled: true
    database_path: "/data/GeoLite2-City.mmdb"
  
  asset:
    enabled: true
    cache_ttl: 5m
  
  agent:
    enabled: true
    cache_ttl: 5m

# 输出配置
output:
  kafka:
    enabled: true
    brokers:
      - "localhost:19092"
    topic: "edr.events.normalized"
    batch_size: 100
    batch_timeout: 5s
  
  opensearch:
    enabled: true
    addresses:
      - "http://localhost:9200"
    index_prefix: "edr-events"
    bulk_size: 1000
    flush_interval: 100ms
    username: ""
    password: ""
    tls_enabled: false
    tls_skip_verify: true

# 错误处理配置
error_handling:
  max_retries: 3
  retry_backoff: 100ms
  max_backoff: 2s
  backoff_factor: 2.0
  dlq_topic: "edr.dlq"

# 可观测性配置
observability:
  metrics_port: 9091
  metrics_path: "/metrics"
  tracing_enabled: true
  otlp_endpoint: "localhost:4317"
  service_name: "edr-pipeline"
